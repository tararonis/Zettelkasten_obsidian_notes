Tags: #
____
# NDCG (Normalized Discounted Cumulative Gain)
**NDCG** (нормированный дисконтированный кумулятивный выигрыш) — метрика для оценки качества ранжирования, учитывающая порядок элементов и их релевантность

---
## Формулы

1. **Cumulative Gain (CG)**  
   Простая сумма релевантностей первых $n$ элементов в ранжированном списке:  
   $CG@n = \sum_{i=1}^n rel_i$  
   где $rel_i$ — релевантность элемента на позиции $i$.

2. **Discounted Cumulative Gain (DCG)**  
   Учитывает порядок: чем выше позиция релевантного элемента, тем больше вклад. Релевантность "дисконтируется" логарифмом позиции:  
   $DCG@n = \sum_{i=1}^n \frac{rel_i}{\log_2(i + 1)}$

3. **Ideal DCG (IDCG)**  
   Максимально возможный DCG для идеального ранжирования (отсортированного по убыванию релевантности):  
   $IDCG@n = \sum_{i=1}^n \frac{rel_i^{\text{ideal}}}{\log_2(i + 1)}$

4. **NDCG**  
   Нормализованная версия DCG, чтобы значения лежали в диапазоне [0, 1]:  
   $NDCG@n = \frac{DCG@n}{IDCG@n}$

## Пример
### Пример 1: Неидеальное ранжирование
**Данные**:  
Релевантности документов = [5, 3, 2, 1, 4]  
Ранжирование модели: [4, 5, 3, 2, 1] (неидеальный порядок)  
Идеальное ранжирование: [5, 4, 3, 2, 1]

- **DCG@5**:  
  $\frac{4}{\log_2(2)} + \frac{5}{\log_2(3)} + \frac{3}{\log_2(4)} + \frac{2}{\log_2(5)} + \frac{1}{\log_2(6)}$  
  $≈ 4 + 3.15 + 1.5 + 0.86 + 0.39 = 9.9$

- **IDCG@5**:  
  $\frac{5}{\log_2(2)} + \frac{4}{\log_2(3)} + \frac{3}{\log_2(4)} + \frac{2}{\log_2(5)} + \frac{1}{\log_2(6)}$  
  $≈ 5 + 2.52 + 1.5 + 0.86 + 0.39 = 10.27$

- **NDCG@5**:  
  $\frac{9.9}{10.27} ≈ 0.96$

---

### Пример 2: Ошибка в топе списка
**Данные**:  
Релевантности документов = [10, 9, 8, 7]  
Ранжирование модели: [7, 8, 9, 10] (обратный порядок)  
Идеальное ранжирование: [10, 9, 8, 7]

- **DCG@4**:  
  $\frac{7}{\log_2(2)} + \frac{8}{\log_2(3)} + \frac{9}{\log_2(4)} + \frac{10}{\log_2(5)}$  
  $≈ 7 + 5.04 + 4.5 + 4.31 = 20.85$

- **IDCG@4**:  
  $\frac{10}{\log_2(2)} + \frac{9}{\log_2(3)} + \frac{8}{\log_2(4)} + \frac{7}{\log_2(5)}$  
  $≈ 10 + 5.68 + 4.0 + 3.02 = 22.7$

- **NDCG@4**:  
  $\frac{20.85}{22.7} ≈ 0.92$

---

### Пример 3: Частично правильное ранжирование
**Данные**:  
Релевантности документов = [2, 5, 3, 1]  
Ранжирование модели: [5, 2, 3, 1] (частично совпадает с идеалом)  
Идеальное ранжирование: [5, 3, 2, 1]

- **DCG@4**:  
  $\frac{5}{\log_2(2)} + \frac{2}{\log_2(3)} + \frac{3}{\log_2(4)} + \frac{1}{\log_2(5)}$  
  $≈ 5 + 1.26 + 1.5 + 0.43 = 8.19$

- **IDCG@4**:  
  $\frac{5}{\log_2(2)} + \frac{3}{\log_2(3)} + \frac{2}{\log_2(4)} + \frac{1}{\log_2(5)}$  
  $≈ 5 + 1.89 + 1.0 + 0.43 = 8.32$

- **NDCG@4**:  
  $\frac{8.19}{8.32} ≈ 0.98$

---

## Заключение
- NDCG чувствителен к порядку, особенно в топе списка.
- Даже небольшие ошибки в первых позициях снижают NDCG.
- Идеальный NDCG = 1 достигается только при полном совпадении с идеальным ранжированием.


____
### Zero-Links
[[_RecSys metrics]]

____
### Links